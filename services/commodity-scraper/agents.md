# Commodity Scraper Service (`commodity-scraper`)

Purpose: ingest daily commodity market prices from public providers (starting with Yahoo Finance) and expose them internally over gRPC for other services + the API gateway.

- Language/Runtime: TypeScript on Node.js 18+.
- HTTP: no public REST (internal gRPC only); Fastify may be added later for admin endpoints.
- RPC: gRPC (`@grpc/grpc-js`) with code generated by `ts-proto`.
- Build: `esbuild` bundled for Node 18, output to `dist/index.cjs`.
- Dev: `tsx src/index.ts`.
- Logging: `pino`.

APIs (from `protos/market_data.proto`):
- `ListPrices` — filtered by `commodity_id`, optional time range, optional limit.
- `GetLatestPrice` — most recent price for a commodity.

Behavior:
- On startup, loads commodities and their provider/ticker from the shared `commodities` table.
- For each commodity, fetches ~2 years of daily closes from the configured provider (Yahoo Finance) and upserts into `market_prices` (`commodity_id`, `price`, `currency`, `unit`, `source`, `as_of`).
- Schedules a daily refresh to append the latest close.

Configuration (env):
- `DATABASE_URL` (Postgres)
- `PORT` (gRPC port, default `50060`)
- `SCRAPER_LOOKBACK_DAYS` (default `730`)
- `SCRAPER_INTERVAL_MS` (default `86400000` / 24h)
- `MARKET_PROVIDER` (default `yahoo`)
- `LOG_LEVEL`

Notes:
- Provider registry lives in the shared DB (`price_providers`), future-proofed for API keys / secret manager lookup.
- No secrets are baked into the repo.
